<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Stats - ANTI RUB</title>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #0a0a0a;
            color: white;
            padding: 40px;
            max-width: 800px;
            margin: 0 auto;
        }
        .result {
            background: rgba(0,87,183,0.1);
            border: 2px solid #0057b7;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        .success {
            border-color: #10b981;
            background: rgba(16,185,129,0.1);
        }
        .error {
            border-color: #ef4444;
            background: rgba(239,68,68,0.1);
        }
        button {
            background: linear-gradient(45deg, #0057b7, #ffd700);
            border: none;
            color: white;
            padding: 15px 30px;
            font-size: 16px;
            border-radius: 10px;
            cursor: pointer;
            margin: 10px 5px;
        }
        button:hover {
            transform: translateY(-2px);
        }
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        pre {
            background: rgba(0,0,0,0.5);
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
        .loading {
            animation: blink 1s infinite;
        }
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body>
    <h1>üß™ Test Public Stats</h1>
    <p>–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ —Å—Ç–µ–π–∫—ñ–Ω–≥ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—É –±–µ–∑ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –≥–∞–º–∞–Ω—Ü—è</p>

    <div>
        <button onclick="testConnection()" id="btn1">üîç –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è</button>
        <button onclick="getTotalStaked()" id="btn2">üí∞ –û—Ç—Ä–∏–º–∞—Ç–∏ totalStaked</button>
        <button onclick="checkContract()" id="btn3">üìã –Ü–Ω—Ñ–æ –ø—Ä–æ –∫–æ–Ω—Ç—Ä–∞–∫—Ç</button>
    </div>

    <div id="results"></div>

    <script>
        const CONFIG = {
            STAKING_ADDRESS: '0x47B302F223ae94e9efcABc27DE19C0a2eC268Df3',
            RPC_URLS: [
                'https://rpc.sepolia.org',
                'https://ethereum-sepolia-rpc.publicnode.com',
                'https://rpc2.sepolia.org',
                'https://sepolia.gateway.tenderly.co'
            ]
        };

        const STAKING_ABI = [
            'function totalStaked() view returns (uint256)',
            'function currentAPY() view returns (uint256)',
            'function totalStakers() view returns (uint256)',
            'function owner() view returns (address)'
        ];

        let currentProvider = null;

        function log(message, type = 'info') {
            const resultsDiv = document.getElementById('results');
            const resultDiv = document.createElement('div');
            resultDiv.className = `result ${type}`;
            resultDiv.innerHTML = `<strong>${new Date().toLocaleTimeString()}</strong><br>${message}`;
            resultsDiv.insertBefore(resultDiv, resultsDiv.firstChild);
        }

        async function getProvider() {
            if (currentProvider) return currentProvider;

            log('üîµ –ü–æ—à—É–∫ —Ä–æ–±–æ—á–æ–≥–æ RPC...', 'info');
            
            for (const rpcUrl of CONFIG.RPC_URLS) {
                try {
                    log(`üì° –°–ø—Ä–æ–±–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è: ${rpcUrl}`, 'info');
                    const provider = new ethers.providers.JsonRpcProvider(rpcUrl);
                    
                    // Test connection
                    const blockNumber = await provider.getBlockNumber();
                    log(`‚úÖ –ü—ñ–¥–∫–ª—é—á–µ–Ω–æ! –ë–ª–æ–∫: ${blockNumber}`, 'success');
                    
                    currentProvider = provider;
                    return provider;
                } catch (error) {
                    log(`‚ùå ${rpcUrl} - –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π`, 'error');
                }
            }
            
            throw new Error('–í—Å—ñ RPC –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ñ');
        }

        async function testConnection() {
            const btn = document.getElementById('btn1');
            btn.disabled = true;
            
            try {
                log('üîµ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è...', 'info');
                
                if (typeof ethers === 'undefined') {
                    log('‚ùå Ethers.js –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ!', 'error');
                    return;
                }
                log('‚úÖ Ethers.js –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ: v' + ethers.version, 'success');
                
                const provider = await getProvider();
                const network = await provider.getNetwork();
                
                log(`‚úÖ –ú–µ—Ä–µ–∂–∞: ${network.name} (chainId: ${network.chainId})`, 'success');
                
                if (network.chainId !== 11155111) {
                    log(`‚ö†Ô∏è –£–≤–∞–≥–∞! ChainId ${network.chainId} –Ω–µ —î Sepolia (11155111)`, 'error');
                }
                
                const blockNumber = await provider.getBlockNumber();
                log(`‚úÖ –ü–æ—Ç–æ—á–Ω–∏–π –±–ª–æ–∫: ${blockNumber}`, 'success');
                
            } catch (error) {
                log(`‚ùå –ü–æ–º–∏–ª–∫–∞: ${error.message}`, 'error');
                console.error(error);
            } finally {
                btn.disabled = false;
            }
        }

        async function getTotalStaked() {
            const btn = document.getElementById('btn2');
            btn.disabled = true;
            
            try {
                log('üîµ –ß–∏—Ç–∞–Ω–Ω—è totalStaked –∑ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—É...', 'info');
                log(`üìç –ê–¥—Ä–µ—Å–∞: ${CONFIG.STAKING_ADDRESS}`, 'info');
                
                const provider = await getProvider();
                const contract = new ethers.Contract(CONFIG.STAKING_ADDRESS, STAKING_ABI, provider);
                
                log('üì° –í–∏–∫–ª–∏–∫ totalStaked()...', 'info');
                const totalStaked = await contract.totalStaked();
                
                log(`‚úÖ totalStaked (raw): ${totalStaked.toString()}`, 'success');
                
                const formatted = ethers.utils.formatUnits(totalStaked, 6);
                log(`‚úÖ totalStaked: ${formatted} —Ç–æ–∫–µ–Ω—ñ–≤`, 'success');
                
                if (totalStaked.eq(0)) {
                    log('‚ö†Ô∏è –ü–æ–∫–∏ —â–æ –Ω–µ–º–∞—î –∑–∞—Å—Ç–µ–π–∫–∞–Ω–∏—Ö —Ç–æ–∫–µ–Ω—ñ–≤', 'error');
                } else {
                    // Calculate USD value
                    const arubPrice = 81.22;
                    const usdValue = parseFloat(formatted) * arubPrice;
                    log(`üíµ –í–∞—Ä—Ç—ñ—Å—Ç—å: $${usdValue.toLocaleString('en-US', { maximumFractionDigits: 2 })}`, 'success');
                }
                
            } catch (error) {
                log(`‚ùå –ü–æ–º–∏–ª–∫–∞: ${error.message}`, 'error');
                console.error('Full error:', error);
                
                if (error.reason) {
                    log(`üìù –ü—Ä–∏—á–∏–Ω–∞: ${error.reason}`, 'error');
                }
                if (error.code === 'CALL_EXCEPTION') {
                    log('‚ö†Ô∏è –§—É–Ω–∫—Ü—ñ—è totalStaked() –º–æ–∂–µ –±—É—Ç–∏ –≤—ñ–¥—Å—É—Ç–Ω—è –≤ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ñ', 'error');
                }
            } finally {
                btn.disabled = false;
            }
        }

        async function checkContract() {
            const btn = document.getElementById('btn3');
            btn.disabled = true;
            
            try {
                log('üîµ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—É...', 'info');
                
                const provider = await getProvider();
                
                log('üì° –û—Ç—Ä–∏–º–∞–Ω–Ω—è –∫–æ–¥—É –∫–æ–Ω—Ç—Ä–∞–∫—Ç—É...', 'info');
                const code = await provider.getCode(CONFIG.STAKING_ADDRESS);
                
                if (code === '0x') {
                    log('‚ùå –ö–æ–Ω—Ç—Ä–∞–∫—Ç –ù–ï –∑–Ω–∞–π–¥–µ–Ω–æ!', 'error');
                    log('‚ö†Ô∏è –ö–æ–Ω—Ç—Ä–∞–∫—Ç –Ω–µ –∑–∞–¥–µ–ø–ª–æ—î–Ω–æ –∞–±–æ –∞–¥—Ä–µ—Å–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞', 'error');
                } else {
                    log('‚úÖ –ö–æ–Ω—Ç—Ä–∞–∫—Ç –∑–Ω–∞–π–¥–µ–Ω–æ!', 'success');
                    log(`üìù –†–æ–∑–º—ñ—Ä –∫–æ–¥—É: ${(code.length - 2) / 2} –±–∞–π—Ç`, 'success');
                    
                    // Try to get owner
                    try {
                        const contract = new ethers.Contract(CONFIG.STAKING_ADDRESS, STAKING_ABI, provider);
                        const owner = await contract.owner();
                        log(`üë§ Owner: ${owner}`, 'success');
                    } catch (e) {
                        log(`‚ö†Ô∏è –ù–µ –≤–¥–∞–ª–æ—Å—å –æ—Ç—Ä–∏–º–∞—Ç–∏ owner (–º–æ–∂–ª–∏–≤–æ —Ñ—É–Ω–∫—Ü—ñ—è –≤—ñ–¥—Å—É—Ç–Ω—è)`, 'error');
                    }
                }
                
                // Check Etherscan link
                const etherscanLink = `https://sepolia.etherscan.io/address/${CONFIG.STAKING_ADDRESS}`;
                log(`üîó <a href="${etherscanLink}" target="_blank" style="color: #ffd700; text-decoration: underline;">–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –Ω–∞ Etherscan ‚Üí</a>`, 'info');
                
            } catch (error) {
                log(`‚ùå –ü–æ–º–∏–ª–∫–∞: ${error.message}`, 'error');
                console.error(error);
            } finally {
                btn.disabled = false;
            }
        }

        // Auto-run on load
        window.addEventListener('DOMContentLoaded', () => {
            log('üöÄ –°—Ç–æ—Ä—ñ–Ω–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∞', 'success');
            
            // Check if ethers is loaded
            if (typeof ethers === 'undefined') {
                log('‚ùå Ethers.js –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ! –ü–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ —Å—Ç–æ—Ä—ñ–Ω–∫—É', 'error');
            } else {
                log(`‚úÖ Ethers.js v${ethers.version} –≥–æ—Ç–æ–≤–∏–π`, 'success');
                log('üí° –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –∫–Ω–æ–ø–∫–∏ –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—É', 'info');
            }
        });
    </script>
</body>
</html>
