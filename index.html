<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ANTI RUB - Debug ABI</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: monospace;
            background: #1a1a2e;
            color: #00ff00;
            padding: 20px;
        }
        .section {
            background: #000;
            border: 1px solid #00ff00;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        h2 { color: #ffd700; margin-bottom: 15px; }
        pre {
            background: #111;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            font-size: 12px;
            line-height: 1.5;
        }
        .function {
            padding: 8px;
            margin: 5px 0;
            background: #1a3a1a;
            border-left: 3px solid #00ff00;
            cursor: pointer;
        }
        .function:hover { background: #2a4a2a; }
        button {
            background: #00ff00;
            color: #000;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            margin: 10px 5px;
        }
        button:hover { background: #00cc00; }
        .error { color: #ff0000; }
        .success { color: #00ff00; }
    </style>
</head>
<body>
    <h1>üîç ANTI RUB - ABI Debugger</h1>

    <div class="section">
        <h2>ARUB Token Contract</h2>
        <p><strong>Address:</strong> 0x98fFc1A4Ff6eAD8EebFd02cDA54852Bb69744788</p>
        <button onclick="getABI('ARUB')">Get ARUB ABI</button>
        <div id="arub-functions"></div>
        <pre id="arub-abi" style="display: none;"></pre>
    </div>

    <div class="section">
        <h2>Staking Contract</h2>
        <p><strong>Address:</strong> 0xd98F611370262f7494eee27f55bc9a8922a9a66d</p>
        <button onclick="getABI('STAKING')">Get STAKING ABI</button>
        <div id="staking-functions"></div>
        <pre id="staking-abi" style="display: none;"></pre>
    </div>

    <div class="section">
        <h2>Test Contract Calls</h2>
        <button onclick="testCalls()">Test All Functions</button>
        <pre id="test-results"></pre>
    </div>

    <script>
        const API = 'https://api-sepolia.etherscan.io/api';
        const KEY = '8RRYGRNGET898XK9PHYBT6KIUZSZK9WPF9';
        const CONTRACTS = {
            ARUB: '0x98fFc1A4Ff6eAD8EebFd02cDA54852Bb69744788',
            STAKING: '0xd98F611370262f7494eee27f55bc9a8922a9a66d'
        };

        async function getABI(contractType) {
            const address = CONTRACTS[contractType];
            const url = `${API}?module=contract&action=getabi&address=${address}&apikey=${KEY}`;
            
            try {
                console.log(`Fetching ABI for ${contractType}...`);
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.status === '1') {
                    const abi = JSON.parse(data.result);
                    
                    // –ü–æ–∫–∞–∑—É—î–º–æ ABI
                    document.getElementById(`${contractType.toLowerCase()}-abi`).textContent = 
                        JSON.stringify(abi, null, 2);
                    
                    // –í–∏—Ç—è–≥—É—î–º–æ view —Ñ—É–Ω–∫—Ü—ñ—ó
                    const viewFunctions = abi.filter(item => 
                        item.type === 'function' && 
                        (item.stateMutability === 'view' || item.stateMutability === 'pure')
                    );
                    
                    let html = '<h3>View Functions:</h3>';
                    viewFunctions.forEach(fn => {
                        const inputs = fn.inputs.map(i => `${i.type} ${i.name}`).join(', ');
                        const outputs = fn.outputs.map(o => o.type).join(', ');
                        html += `<div class="function" onclick="callFunction('${contractType}', '${fn.name}')">
                            <strong>${fn.name}</strong>(${inputs}) ‚Üí ${outputs}
                        </div>`;
                    });
                    
                    document.getElementById(`${contractType.toLowerCase()}-functions`).innerHTML = html;
                    
                    console.log(`‚úÖ Found ${viewFunctions.length} view functions in ${contractType}`);
                } else {
                    console.error(`‚ùå ${contractType} ABI error:`, data.result);
                    document.getElementById(`${contractType.toLowerCase()}-functions`).innerHTML = 
                        `<p class="error">Error: ${data.result}</p>`;
                }
            } catch (error) {
                console.error(`‚ùå Error fetching ${contractType} ABI:`, error);
            }
        }

        async function callFunction(contractType, functionName) {
            const address = CONTRACTS[contractType];
            
            // Calculate function selector (first 4 bytes of keccak256 hash)
            // For now, we'll use known selectors
            const selectors = {
                'totalSupply': '0x18160ddd',
                'totalStaked': '0x817b1cd2',
                'currentAPY': '0xc5ab3ba6',
                'balanceOf': '0x70a08231'
            };
            
            const selector = selectors[functionName];
            if (!selector) {
                alert('Function selector not found. Add it to the code.');
                return;
            }
            
            try {
                const url = `${API}?module=proxy&action=eth_call&to=${address}&data=${selector}&tag=latest&apikey=${KEY}`;
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.status === '1') {
                    const value = parseInt(data.result, 16);
                    console.log(`${contractType}.${functionName}() = ${value} (hex: ${data.result})`);
                    alert(`${functionName}() returned: ${value}\nHex: ${data.result}`);
                } else {
                    console.error(`Error calling ${functionName}:`, data);
                    alert(`Error: ${data.result}`);
                }
            } catch (error) {
                console.error(`Error:`, error);
                alert(`Error: ${error.message}`);
            }
        }

        async function testCalls() {
            const results = document.getElementById('test-results');
            results.textContent = 'Testing...\n\n';
            
            try {
                // Test ARUB totalSupply
                results.textContent += 'üìä Testing ARUB.totalSupply()...\n';
                let url = `${API}?module=proxy&action=eth_call&to=${CONTRACTS.ARUB}&data=0x18160ddd&tag=latest&apikey=${KEY}`;
                let res = await fetch(url);
                let data = await res.json();
                results.textContent += `Result: ${data.result}\n`;
                results.textContent += `Decimal: ${parseInt(data.result, 16)}\n`;
                results.textContent += `Formatted (6 decimals): ${parseInt(data.result, 16) / 1000000}\n\n`;
                
                // Test STAKING totalStaked
                results.textContent += 'üìä Testing STAKING.totalStaked()...\n';
                url = `${API}?module=proxy&action=eth_call&to=${CONTRACTS.STAKING}&data=0x817b1cd2&tag=latest&apikey=${KEY}`;
                res = await fetch(url);
                data = await res.json();
                results.textContent += `Result: ${data.result}\n`;
                results.textContent += `Decimal: ${parseInt(data.result, 16)}\n`;
                results.textContent += `Formatted (6 decimals): ${parseInt(data.result, 16) / 1000000}\n\n`;
                
                // Test STAKING currentAPY
                results.textContent += 'üìä Testing STAKING.currentAPY()...\n';
                url = `${API}?module=proxy&action=eth_call&to=${CONTRACTS.STAKING}&data=0xc5ab3ba6&tag=latest&apikey=${KEY}`;
                res = await fetch(url);
                data = await res.json();
                results.textContent += `Result: ${data.result}\n`;
                results.textContent += `Decimal: ${parseInt(data.result, 16)}\n`;
                results.textContent += `APY %: ${parseInt(data.result, 16) / 100}\n\n`;
                
                results.textContent += '‚úÖ Tests completed!';
            } catch (error) {
                results.textContent += `\n‚ùå Error: ${error.message}`;
            }
        }

        // Auto-load ABIs on page load
        window.addEventListener('DOMContentLoaded', () => {
            console.log('üîç ANTI RUB ABI Debugger');
            getABI('ARUB');
            getABI('STAKING');
        });
    </script>
</body>
</html>
