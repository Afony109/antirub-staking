<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ANTI RUB - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</title>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        .header {
            text-align: center;
            padding: 40px 20px;
            background: linear-gradient(90deg, #0057b7 0%, #ffd700 100%);
            border-radius: 15px;
            margin-bottom: 40px;
        }
        .header h1 { font-size: 48px; margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .header p { font-size: 18px; }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .stat-card {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 15px;
            padding: 25px;
            transition: transform 0.3s;
        }
        .stat-card:hover { transform: translateY(-5px); }
        .stat-label {
            font-size: 13px;
            color: rgba(255,255,255,0.7);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }
        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: #ffd700;
            margin-bottom: 5px;
        }
        .stat-subvalue { font-size: 13px; color: rgba(255,255,255,0.6); }
        .loading {
            text-align: center;
            padding: 40px;
            font-size: 14px;
            color: rgba(255,255,255,0.7);
        }
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255,255,255,0.3);
            border-top-color: #ffd700;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        .info { 
            text-align: center; 
            color: rgba(255,255,255,0.6); 
            font-size: 14px; 
            margin: 20px 0;
            padding: 10px;
            background: rgba(0,255,0,0.1);
            border-radius: 8px;
        }
        .footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: rgba(255,255,255,0.5);
            font-size: 14px;
        }
        .debug {
            background: rgba(0,0,0,0.3);
            padding: 10px;
            border-radius: 8px;
            font-size: 12px;
            font-family: monospace;
            margin: 20px 0;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ ANTI RUB</h1>
            <p>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∏ —Å—Ç–µ–π–∫—ñ–Ω–≥—É</p>
        </div>

        <div id="loading" class="loading">
            <div class="spinner"></div>
            <p id="loadingText">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</p>
        </div>

        <div id="stats" class="stats-grid" style="display: none;">
            <div class="stat-card">
                <div class="stat-label">üí∞ –í—Å—å–æ–≥–æ –∑–∞—Å—Ç–µ–π–∫–∞–Ω–æ</div>
                <div class="stat-value" id="totalStaked">‚Äî</div>
                <div class="stat-subvalue" id="totalStakedTokens">‚Äî</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">üìà –ü–æ—Ç–æ—á–Ω–∏–π APY</div>
                <div class="stat-value" id="apy">‚Äî</div>
                <div class="stat-subvalue">–†—ñ—á–Ω–∏–π –≤—ñ–¥—Å–æ—Ç–æ–∫</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">üöÄ –í–∏–ø—É—â–µ–Ω–æ ARUB</div>
                <div class="stat-value" id="supply">‚Äî</div>
                <div class="stat-subvalue" id="supplyUsd">‚Äî</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">üíµ –¶—ñ–Ω–∞ 1 ARUB</div>
                <div class="stat-value" id="price">‚Äî</div>
                <div class="stat-subvalue">USDT</div>
            </div>
        </div>

        <div id="debugInfo" class="debug" style="display: none;"></div>

        <div class="footer">
            <p>ANTI RUB - DeFi –ø—ñ–¥—Ç—Ä–∏–º–∫–∞ –£–∫—Ä–∞—ó–Ω–∏ üá∫üá¶</p>
            <p>Sepolia Testnet | –ê–≤—Ç–æ–æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ–∂–Ω—ñ 30 —Å–µ–∫—É–Ω–¥</p>
        </div>
    </div>

    <script>
        const CONTRACTS = {
            ARUB: '0xe4A39E3D2C64C2D3a1d9c7C6B9eB63db55277b71',
            STAKING: '0x47B302F223ae94e9efcABc27DE19C0a2eC268Df3'
        };

        const RPC_URL = 'https://rpc.ankr.com/eth_sepolia';
        let rate = 81.22;
        let debugLog = [];

        function addDebug(msg) {
            debugLog.push(msg);
            console.log(msg);
            document.getElementById('debugInfo').textContent = debugLog.join('\n');
        }

        async function getABI(address) {
            try {
                const url = `https://api-sepolia.etherscan.io/api?module=contract&action=getabi&address=${address}`;
                addDebug(`Fetching ABI for ${address}...`);
                
                const res = await fetch(url);
                const data = await res.json();
                
                if (data.status === '1' && data.result) {
                    addDebug(`‚úÖ ABI retrieved (${data.result.length} chars)`);
                    return JSON.parse(data.result);
                } else {
                    addDebug(`‚ö†Ô∏è ABI not found: ${data.result}`);
                    return null;
                }
            } catch (error) {
                addDebug(`‚ùå Error getting ABI: ${error.message}`);
                return null;
            }
        }

        async function getRate() {
            try {
                const res = await fetch('https://api.exchangerate-api.com/v4/latest/USD');
                const data = await res.json();
                if (data.rates && data.rates.RUB) {
                    rate = data.rates.RUB;
                    addDebug(`üí± USDT/RUB: ${rate}`);
                }
            } catch (e) {
                addDebug('‚ö†Ô∏è Using default rate: 81.22');
            }
        }

        async function loadStats() {
            try {
                debugLog = [];
                document.getElementById('debugInfo').style.display = 'block';
                document.getElementById('loading').style.display = 'block';
                document.getElementById('stats').style.display = 'none';

                addDebug('üöÄ Starting...');
                
                document.getElementById('loadingText').textContent = '–û—Ç—Ä–∏–º–∞–Ω–Ω—è –∫—É—Ä—Å—É...';
                await getRate();

                document.getElementById('loadingText').textContent = '–ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ RPC...';
                addDebug(`üîó Connecting to ${RPC_URL}...`);
                
                const provider = new ethers.providers.JsonRpcProvider(RPC_URL);
                const blockNumber = await provider.getBlockNumber();
                addDebug(`‚úÖ Connected! Block: ${blockNumber}`);

                // –û—Ç—Ä–∏–º—É—î–º–æ ABI –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ñ–≤
                document.getElementById('loadingText').textContent = '–û—Ç—Ä–∏–º–∞–Ω–Ω—è ABI –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ñ–≤...';
                
                const stakingABI = await getABI(CONTRACTS.STAKING);
                const tokenABI = await getABI(CONTRACTS.ARUB);

                if (!stakingABI || !tokenABI) {
                    throw new Error('–ù–µ –≤–¥–∞–ª–æ—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ ABI –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ñ–≤');
                }

                // –°—Ç–≤–æ—Ä—é—î–º–æ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∏ –∑ —Ä–µ–∞–ª—å–Ω–∏–º–∏ ABI
                const stakingContract = new ethers.Contract(CONTRACTS.STAKING, stakingABI, provider);
                const tokenContract = new ethers.Contract(CONTRACTS.ARUB, tokenABI, provider);

                addDebug('üìÑ Contracts initialized');

                // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —è–∫—ñ —Ñ—É–Ω–∫—Ü—ñ—ó –¥–æ—Å—Ç—É–ø–Ω—ñ
                document.getElementById('loadingText').textContent = '–ß–∏—Ç–∞–Ω–Ω—è —Ñ—É–Ω–∫—Ü—ñ–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç—É...';
                
                addDebug('\nStaking contract functions:');
                stakingABI.filter(item => item.type === 'function' && item.stateMutability === 'view')
                    .forEach(fn => addDebug(`  - ${fn.name}`));

                addDebug('\nToken contract functions:');
                tokenABI.filter(item => item.type === 'function' && item.stateMutability === 'view')
                    .forEach(fn => addDebug(`  - ${fn.name}`));

                // –ß–∏—Ç–∞—î–º–æ –¥–∞–Ω—ñ
                document.getElementById('loadingText').textContent = '–ß–∏—Ç–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö –∑ –±–ª–æ–∫—á–µ–π–Ω—É...';
                
                let totalStaked = ethers.BigNumber.from(0);
                let currentAPY = 2400;
                let totalSupply = ethers.BigNumber.from(0);

                // –ü—Ä–æ–±—É—î–º–æ —Ä—ñ–∑–Ω—ñ –≤–∞—Ä—ñ–∞–Ω—Ç–∏ –Ω–∞–∑–≤ —Ñ—É–Ω–∫—Ü—ñ–π
                try {
                    if (typeof stakingContract.totalStaked === 'function') {
                        totalStaked = await stakingContract.totalStaked();
                        addDebug(`‚úÖ totalStaked: ${totalStaked.toString()}`);
                    }
                } catch (e) {
                    addDebug(`‚ö†Ô∏è totalStaked failed: ${e.message}`);
                }

                try {
                    if (typeof stakingContract.currentAPY === 'function') {
                        const apy = await stakingContract.currentAPY();
                        currentAPY = parseInt(apy.toString());
                        addDebug(`‚úÖ currentAPY: ${currentAPY}`);
                    }
                } catch (e) {
                    addDebug(`‚ö†Ô∏è currentAPY failed: ${e.message}`);
                }

                try {
                    if (typeof tokenContract.totalSupply === 'function') {
                        totalSupply = await tokenContract.totalSupply();
                        addDebug(`‚úÖ totalSupply: ${totalSupply.toString()}`);
                    }
                } catch (e) {
                    addDebug(`‚ö†Ô∏è totalSupply failed: ${e.message}`);
                }

                // –§–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è
                const totalStakedTokens = parseFloat(ethers.utils.formatUnits(totalStaked, 6));
                const totalStakedUsd = totalStakedTokens * rate;
                const apyValue = currentAPY / 100;
                const totalSupplyTokens = parseFloat(ethers.utils.formatUnits(totalSupply, 6));
                const totalSupplyUsd = totalSupplyTokens * rate;

                addDebug(`\nüìä Formatted data:`);
                addDebug(`  Staked: ${totalStakedTokens} ARUB ($${totalStakedUsd.toFixed(2)})`);
                addDebug(`  Supply: ${totalSupplyTokens} ARUB ($${totalSupplyUsd.toFixed(2)})`);
                addDebug(`  APY: ${apyValue}%`);

                // –û–Ω–æ–≤–ª–µ–Ω–Ω—è UI
                document.getElementById('totalStaked').textContent = 
                    '$' + totalStakedUsd.toLocaleString('en-US', { maximumFractionDigits: 0 });
                document.getElementById('totalStakedTokens').textContent = 
                    totalStakedTokens.toLocaleString('en-US', { maximumFractionDigits: 2 }) + ' —Ç–æ–∫–µ–Ω—ñ–≤';
                document.getElementById('apy').textContent = apyValue + '%';
                document.getElementById('supply').textContent = 
                    totalSupplyTokens.toLocaleString('en-US', { maximumFractionDigits: 0 });
                document.getElementById('supplyUsd').textContent = 
                    '$' + totalSupplyUsd.toLocaleString('en-US', { maximumFractionDigits: 0 });
                document.getElementById('price').textContent = rate.toFixed(2);

                document.getElementById('loading').style.display = 'none';
                document.getElementById('stats').style.display = 'grid';

                addDebug('\n‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∞ —É—Å–ø—ñ—à–Ω–æ!');
            } catch (error) {
                addDebug(`\n‚ùå ERROR: ${error.message}`);
                document.getElementById('loadingText').textContent = '‚ùå –ü–æ–º–∏–ª–∫–∞: ' + error.message;
            }
        }

        window.addEventListener('DOMContentLoaded', () => {
            console.log('üöÄ ANTI RUB Stats - Starting...');
            loadStats();
            setInterval(loadStats, 30000);
        });
    </script>
</body>
</html>
