<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ANTI RUB - –°—Ç–µ–π–∫–∏–Ω–≥ –∏ –∑–∞—â–∏—Ç–∞ –æ—Ç –¥–µ–≤–∞–ª—å–≤–∞—Ü–∏–∏ —Ä—É–±–ª—è</title>
    
    <!-- Ethers.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    
    <style>
        :root {
            --primary: #667eea;
            --secondary: #764ba2;
            --accent: #4ade80;
            --dark: #0a0a0a;
            --gray: #888;
            --red: #ef4444;
            --card-bg: rgba(255,255,255,0.05);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--dark);
            color: #fff;
            overflow-x: hidden;
            line-height: 1.6;
        }
        
        /* Animated Background */
        .bg-animated {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            opacity: 0.05;
        }
        
        /* Navigation */
        nav {
            position: fixed;
            top: 0;
            width: 100%;
            padding: 20px 50px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 1000;
            background: rgba(10, 10, 10, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8em;
            font-weight: bold;
        }
        
        .logo-text {
            font-size: 1.8em;
            font-weight: bold;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .nav-right {
            display: flex;
            gap: 20px;
            align-items: center;
        }
        
        .lang-switcher {
            display: flex;
            gap: 10px;
            background: var(--card-bg);
            border-radius: 20px;
            padding: 5px;
        }
        
        .lang-btn {
            padding: 8px 15px;
            border-radius: 15px;
            border: none;
            background: transparent;
            color: var(--gray);
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9em;
        }
        
        .lang-btn.active {
            background: var(--primary);
            color: white;
        }
        
        .connect-btn {
            padding: 12px 30px;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            border: none;
            border-radius: 25px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .connect-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(102,126,234,0.5);
        }
        
        .wallet-info {
            display: none;
            flex-direction: column;
            align-items: flex-end;
            gap: 5px;
        }
        
        .wallet-info.connected {
            display: flex;
        }
        
        .wallet-address {
            font-size: 0.9em;
            color: var(--accent);
            cursor: pointer;
        }
        
        .wallet-balance {
            font-size: 0.8em;
            color: var(--gray);
        }
        
        .disconnect-btn {
            font-size: 0.8em;
            color: var(--red);
            background: none;
            border: none;
            cursor: pointer;
            margin-top: 5px;
        }
        
        /* Wallet Modal */
        .wallet-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }
        
        .wallet-modal.show {
            display: flex;
        }
        
        .wallet-modal-content {
            background: rgba(20, 20, 20, 0.98);
            border: 2px solid rgba(102,126,234,0.3);
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }
        
        .wallet-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .wallet-modal-title {
            font-size: 1.5em;
            font-weight: bold;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .wallet-modal-close {
            background: none;
            border: none;
            color: #fff;
            font-size: 1.5em;
            cursor: pointer;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s;
        }
        
        .wallet-modal-close:hover {
            background: rgba(255,255,255,0.1);
        }
        
        .wallet-options {
            display: grid;
            gap: 15px;
        }
        
        .wallet-option {
            display: flex;
            align-items: center;
            gap: 20px;
            padding: 20px;
            background: var(--card-bg);
            border: 2px solid rgba(102,126,234,0.2);
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .wallet-option:hover {
            border-color: var(--primary);
            transform: translateX(5px);
            box-shadow: 0 10px 30px rgba(102,126,234,0.3);
        }
        
        .wallet-option.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .wallet-option.disabled:hover {
            transform: none;
            border-color: rgba(102,126,234,0.2);
        }
        
        .wallet-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            background: rgba(255,255,255,0.1);
        }
        
        .wallet-details {
            flex: 1;
        }
        
        .wallet-name {
            font-weight: 600;
            font-size: 1.1em;
            margin-bottom: 5px;
        }
        
        .wallet-description {
            font-size: 0.85em;
            color: var(--gray);
        }
        
        .wallet-tag {
            background: var(--primary);
            color: white;
            padding: 3px 10px;
            border-radius: 10px;
            font-size: 0.75em;
            font-weight: 600;
        }
        
        .wallet-tag.detected {
            background: var(--accent);
        }
        
        .wallet-tag.not-found {
            background: var(--gray);
        }
        
        /* Main Container */
        .container {
            max-width: 1400px;
            margin: 100px auto 50px;
            padding: 20px;
        }
        
        /* Hero Stats */
        .hero-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .stat-card {
            background: var(--card-bg);
            border: 2px solid rgba(102,126,234,0.3);
            border-radius: 20px;
            padding: 30px;
            transition: all 0.3s;
            text-align: center;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
            box-shadow: 0 15px 40px rgba(102,126,234,0.3);
        }
        
        .stat-label {
            color: var(--gray);
            font-size: 0.9em;
            margin-bottom: 10px;
        }
        
        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
            background: linear-gradient(45deg, var(--accent), #22c55e);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .stat-change {
            margin-top: 10px;
            font-size: 0.9em;
        }
        
        .stat-change.positive {
            color: var(--accent);
        }
        
        .stat-change.negative {
            color: var(--red);
        }
        
        /* Rate Card */
        .rate-card {
            background: linear-gradient(135deg, rgba(102,126,234,0.1), rgba(118,75,162,0.1));
            border: 2px solid var(--primary);
        }
        
        .rate-value {
            font-size: 3em;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .rate-timestamp {
            font-size: 0.8em;
            color: var(--gray);
            margin-top: 5px;
        }
        
        /* Dashboard Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-top: 40px;
        }
        
        .dashboard-card {
            background: var(--card-bg);
            border: 2px solid rgba(102,126,234,0.2);
            border-radius: 20px;
            padding: 30px;
            transition: all 0.3s;
        }
        
        .dashboard-card:hover {
            border-color: var(--primary);
            box-shadow: 0 15px 40px rgba(102,126,234,0.2);
        }
        
        .card-title {
            font-size: 1.3em;
            font-weight: 600;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .card-icon {
            font-size: 1.5em;
        }
        
        .balance-display {
            background: rgba(74,222,128,0.1);
            border: 2px solid var(--accent);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .balance-amount {
            font-size: 2.5em;
            font-weight: bold;
            color: var(--accent);
        }
        
        .balance-usd {
            color: var(--gray);
            margin-top: 5px;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        .input-label {
            display: block;
            margin-bottom: 10px;
            color: var(--gray);
            font-size: 0.9em;
        }
        
        .input-wrapper {
            position: relative;
            display: flex;
            gap: 10px;
        }
        
        .input-field {
            flex: 1;
            padding: 15px;
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(102,126,234,0.3);
            border-radius: 12px;
            color: white;
            font-size: 1em;
            transition: all 0.3s;
        }
        
        .input-field:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 20px rgba(102,126,234,0.3);
        }
        
        .max-btn {
            padding: 10px 20px;
            background: rgba(102,126,234,0.2);
            border: 2px solid var(--primary);
            border-radius: 12px;
            color: var(--primary);
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }
        
        .max-btn:hover {
            background: var(--primary);
            color: white;
        }
        
        .action-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            border: none;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }
        
        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(102,126,234,0.5);
        }
        
        .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .action-btn.secondary {
            background: rgba(102,126,234,0.2);
            border: 2px solid var(--primary);
        }
        
        .staking-info {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }
        
        .info-item {
            background: rgba(255,255,255,0.03);
            padding: 15px;
            border-radius: 12px;
        }
        
        .info-label {
            color: var(--gray);
            font-size: 0.85em;
            margin-bottom: 5px;
        }
        
        .info-value {
            font-size: 1.3em;
            font-weight: 600;
            color: var(--accent);
        }
        
        /* Notification */
        .notification {
            position: fixed;
            top: 100px;
            right: -400px;
            background: var(--card-bg);
            border: 2px solid var(--primary);
            border-radius: 15px;
            padding: 20px;
            min-width: 300px;
            z-index: 3000;
            transition: right 0.5s;
            backdrop-filter: blur(20px);
        }
        
        .notification.show {
            right: 20px;
        }
        
        .notification.success {
            border-color: var(--accent);
        }
        
        .notification.error {
            border-color: var(--red);
        }
        
        /* Footer */
        footer {
            text-align: center;
            padding: 40px 20px;
            color: var(--gray);
            border-top: 1px solid rgba(255,255,255,0.1);
            margin-top: 60px;
        }
        
        .footer-links {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 20px;
        }
        
        .footer-links a {
            color: var(--primary);
            text-decoration: none;
            transition: color 0.3s;
        }
        
        .footer-links a:hover {
            color: var(--accent);
        }
        
        .no-wallets-msg {
            text-align: center;
            padding: 30px;
            color: var(--gray);
        }
        
        .no-wallets-msg h3 {
            color: white;
            margin-bottom: 15px;
        }
        
        .install-links {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 20px;
        }
        
        .install-link {
            padding: 12px 20px;
            background: var(--card-bg);
            border: 2px solid var(--primary);
            border-radius: 12px;
            color: var(--primary);
            text-decoration: none;
            transition: all 0.3s;
        }
        
        .install-link:hover {
            background: var(--primary);
            color: white;
        }
        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            nav {
                padding: 15px 20px;
                flex-wrap: wrap;
            }
            
            .logo-text {
                font-size: 1.3em;
            }
            
            .nav-right {
                width: 100%;
                justify-content: space-between;
                margin-top: 15px;
            }
            
            .container {
                margin-top: 150px;
            }
            
            .hero-stats {
                grid-template-columns: 1fr;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .wallet-modal-content {
                padding: 25px;
            }
            
            .staking-info {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="bg-animated"></div>
    
    <nav>
        <div class="logo">
            <div class="logo-icon">‚ÇΩ</div>
            <div class="logo-text">ANTI RUB</div>
        </div>
        
        <div class="nav-right">
            <div class="lang-switcher">
                <button class="lang-btn active" onclick="switchLanguage('ru')">RU</button>
                <button class="lang-btn" onclick="switchLanguage('en')">EN</button>
            </div>
            
            <button class="connect-btn" id="connectBtn" onclick="openWalletModal()">
                <span class="connect-text">–ü–æ–¥–∫–ª—é—á–∏—Ç—å –∫–æ—à–µ–ª–µ–∫</span>
            </button>
            
            <div class="wallet-info" id="walletInfo">
                <div class="wallet-address" id="walletAddress" onclick="copyAddress()"></div>
                <div class="wallet-balance" id="walletBalance">0 ETH</div>
                <button class="disconnect-btn" onclick="disconnectWallet()">–û—Ç–∫–ª—é—á–∏—Ç—å</button>
            </div>
        </div>
    </nav>
    
    <!-- Wallet Modal -->
    <div class="wallet-modal" id="walletModal">
        <div class="wallet-modal-content">
            <div class="wallet-modal-header">
                <h2 class="wallet-modal-title">–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ—à–µ–ª–µ–∫</h2>
                <button class="wallet-modal-close" onclick="closeWalletModal()">√ó</button>
            </div>
            
            <div class="wallet-options" id="walletOptions">
                <!-- Wallets will be dynamically loaded here -->
            </div>
        </div>
    </div>
    
    <div class="container">
        <!-- Hero Stats -->
        <div class="hero-stats">
            <div class="stat-card rate-card">
                <div class="stat-label">USDT/RUB –ö—É—Ä—Å</div>
                <div class="rate-value" id="usdtRubRate">0.00 ‚ÇΩ</div>
                <div class="rate-timestamp" id="rateTimestamp">–û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è...</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-label">–î–µ–≤–∞–ª—å–≤–∞—Ü–∏—è —Ä—É–±–ª—è</div>
                <div class="stat-value" id="devaluation">0%</div>
                <div class="stat-change negative" id="devaluationChange">‚Üì -0.0% –∑–∞ –º–µ—Å—è—Ü</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-label">–í—Å–µ–≥–æ –∑–∞—Å—Ç–µ–π–∫–∞–Ω–æ</div>
                <div class="stat-value" id="totalStaked">0</div>
                <div class="stat-change positive">ANTI RUB —Ç–æ–∫–µ–Ω–æ–≤</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-label">APY</div>
                <div class="stat-value">12%</div>
                <div class="stat-change positive">+ –ó–∞—â–∏—Ç–∞ –æ—Ç –¥–µ–≤–∞–ª—å–≤–∞—Ü–∏–∏</div>
            </div>
        </div>
        
        <!-- Dashboard -->
        <div class="dashboard-grid">
            <!-- Balance Card -->
            <div class="dashboard-card">
                <h3 class="card-title">
                    <span class="card-icon">üí∞</span>
                    –í–∞—à –±–∞–ª–∞–Ω—Å
                </h3>
                
                <div class="balance-display">
                    <div class="balance-amount" id="userBalance">0.00</div>
                    <div class="balance-label">ANTI RUB</div>
                    <div class="balance-usd" id="usdValue">$0.00</div>
                </div>
                
                <div class="staking-info">
                    <div class="info-item">
                        <div class="info-label">–ó–∞—Å—Ç–µ–π–∫–∞–Ω–æ</div>
                        <div class="info-value" id="stakedAmount">0</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ</div>
                        <div class="info-value" id="rewardsEarned">0</div>
                    </div>
                </div>
            </div>
            
            <!-- Staking Card -->
            <div class="dashboard-card">
                <h3 class="card-title">
                    <span class="card-icon">üîí</span>
                    –°—Ç–µ–π–∫–∏–Ω–≥
                </h3>
                
                <div class="input-group">
                    <label class="input-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–∫–µ–Ω–æ–≤</label>
                    <div class="input-wrapper">
                        <input type="number" class="input-field" id="stakeAmount" placeholder="0.00">
                        <button class="max-btn" onclick="setMaxAmount()">MAX</button>
                    </div>
                </div>
                
                <button class="action-btn secondary" onclick="approveTokens()">
                    1Ô∏è‚É£ –û–¥–æ–±—Ä–∏—Ç—å —Ç–æ–∫–µ–Ω—ã
                </button>
                
                <button class="action-btn" onclick="stakeTokens()">
                    2Ô∏è‚É£ –ó–∞—Å—Ç–µ–π–∫–∞—Ç—å
                </button>
                
                <button class="action-btn secondary" onclick="unstakeTokens()">
                    –í—ã–≤–µ—Å—Ç–∏ –∏–∑ —Å—Ç–µ–π–∫–∏–Ω–≥–∞
                </button>
            </div>
            
            <!-- Rewards Card -->
            <div class="dashboard-card">
                <h3 class="card-title">
                    <span class="card-icon">üéÅ</span>
                    –ù–∞–≥—Ä–∞–¥—ã
                </h3>
                
                <div class="balance-display">
                    <div class="balance-amount" id="rewardsDisplay">0.00</div>
                    <div class="balance-label">ANTI RUB</div>
                    <div class="balance-usd">–ù–∞–≥—Ä–∞–¥—ã –≥–æ—Ç–æ–≤—ã –∫ –≤—ã–≤–æ–¥—É</div>
                </div>
                
                <button class="action-btn" onclick="claimRewards()">
                    –ó–∞–±—Ä–∞—Ç—å –Ω–∞–≥—Ä–∞–¥—ã
                </button>
                
                <div class="info-item" style="margin-top: 20px;">
                    <div class="info-label">APY</div>
                    <div class="info-value">12%</div>
                </div>
            </div>
        </div>
    </div>
    
    <footer>
        <p>ANTI RUB - –ó–∞—â–∏—Ç–∞ –æ—Ç –¥–µ–≤–∞–ª—å–≤–∞—Ü–∏–∏ —Ä—É–±–ª—è —á–µ—Ä–µ–∑ –¥–µ—Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Å—Ç–µ–π–∫–∏–Ω–≥</p>
        <div class="footer-links">
            <a href="https://sepolia.etherscan.io/address/0xe4A39E3D2C64C2D3a1d9c7C6B9eB63db55277b71" target="_blank">Token Contract</a>
            <a href="https://sepolia.etherscan.io/address/0x47B302F223ae94e9efcABc27DE19C0a2eC268Df3" target="_blank">Staking Contract</a>
            <a href="https://github.com" target="_blank">GitHub</a>
            <a href="https://t.me" target="_blank">Telegram</a>
        </div>
        <p style="margin-top: 20px; font-size: 0.85em;">‚ö†Ô∏è –ü—Ä–æ–µ–∫—Ç –≤ —Å—Ç–∞–¥–∏–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –Ω–∞ Sepolia Testnet. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –Ω–∞ —Å–≤–æ–π —Ä–∏—Å–∫.</p>
        <p style="margin-top: 10px; font-size: 0.9em; color: #4ade80;">‚úÖ <strong>–†–ê–ë–û–¢–ê–ï–¢ –° –†–ï–ê–õ–¨–ù–´–ú–ò –ö–û–ù–¢–†–ê–ö–¢–ê–ú–ò</strong> –Ω–∞ Ethereum Sepolia Testnet</p>
    </footer>
    
    <!-- Notification -->
    <div class="notification" id="notification"></div>
    
    <script>
        // ==========================================
        // TRANSLATIONS
        // ==========================================
        const translations = {
            ru: {
                'connect-wallet': '–ü–æ–¥–∫–ª—é—á–∏—Ç—å –∫–æ—à–µ–ª–µ–∫',
                'disconnect': '–û—Ç–∫–ª—é—á–∏—Ç—å',
                'choose-wallet': '–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ—à–µ–ª–µ–∫',
                'connect-first': '–°–Ω–∞—á–∞–ª–∞ –ø–æ–¥–∫–ª—é—á–∏—Ç–µ –∫–æ—à–µ–ª–µ–∫',
                'invalid-amount': '–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É',
                'approving': '–û–¥–æ–±—Ä–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤...',
                'approve-success': '–¢–æ–∫–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ –æ–¥–æ–±—Ä–µ–Ω—ã!',
                'approve-error': '–û—à–∏–±–∫–∞ –æ–¥–æ–±—Ä–µ–Ω–∏—è: ',
                'staking': '–°—Ç–µ–π–∫–∏–Ω–≥ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ...',
                'stake-success': '–¢–æ–∫–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ –∑–∞—Å—Ç–µ–π–∫–∞–Ω—ã!',
                'stake-error': '–û—à–∏–±–∫–∞ —Å—Ç–µ–π–∫–∏–Ω–≥–∞: ',
                'unstaking': '–í—ã–≤–æ–¥ –∏–∑ —Å—Ç–µ–π–∫–∏–Ω–≥–∞...',
                'unstake-success': '–¢–æ–∫–µ–Ω—ã –≤—ã–≤–µ–¥–µ–Ω—ã –∏–∑ —Å—Ç–µ–π–∫–∏–Ω–≥–∞!',
                'unstake-error': '–û—à–∏–±–∫–∞ –≤—ã–≤–æ–¥–∞: ',
                'claiming': '–ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞–≥—Ä–∞–¥...',
                'claim-success': '–ù–∞–≥—Ä–∞–¥—ã –ø–æ–ª—É—á–µ–Ω—ã!',
                'claim-error': '–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–∞–≥—Ä–∞–¥: ',
                'wallet-not-found': '–ö–æ—à–µ–ª–µ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω',
                'wallet-rejected': '–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ',
                'switch-network': '–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ—Å—å –Ω–∞ Sepolia',
                'copied': '–ê–¥—Ä–µ—Å —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!',
                'connecting': '–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...'
            },
            en: {
                'connect-wallet': 'Connect Wallet',
                'disconnect': 'Disconnect',
                'choose-wallet': 'Choose Wallet',
                'connect-first': 'Please connect wallet first',
                'invalid-amount': 'Enter valid amount',
                'approving': 'Approving tokens...',
                'approve-success': 'Tokens approved successfully!',
                'approve-error': 'Approval error: ',
                'staking': 'Staking in progress...',
                'stake-success': 'Tokens staked successfully!',
                'stake-error': 'Staking error: ',
                'unstaking': 'Unstaking...',
                'unstake-success': 'Tokens unstaked!',
                'unstake-error': 'Unstake error: ',
                'claiming': 'Claiming rewards...',
                'claim-success': 'Rewards claimed!',
                'claim-error': 'Claim error: ',
                'wallet-not-found': 'Wallet not found',
                'wallet-rejected': 'Connection rejected',
                'switch-network': 'Please switch to Sepolia',
                'copied': 'Address copied!',
                'connecting': 'Connecting...'
            }
        };
        
        let currentLang = 'ru';
        
        function switchLanguage(lang) {
            currentLang = lang;
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            updateUILanguage();
        }
        
        function updateUILanguage() {
            document.querySelector('.connect-text').textContent = 
                translations[currentLang]['connect-wallet'];
            document.querySelector('.wallet-modal-title').textContent = 
                translations[currentLang]['choose-wallet'];
            document.querySelector('.disconnect-btn').textContent = 
                translations[currentLang]['disconnect'];
        }
        
        // ==========================================
        // WALLET DETECTION & CONNECTION - EIP-6963
        // ==========================================
        let provider = null;
        let signer = null;
        let userAddress = null;
        let currentWalletType = null;
        
        // Store discovered providers from EIP-6963
        const discoveredProviders = new Map();
        
        // Listen for EIP-6963 announcements
        window.addEventListener('eip6963:announceProvider', (event) => {
            console.log('EIP-6963 provider announced:', event.detail);
            const { info, provider } = event.detail;
            discoveredProviders.set(info.uuid, { info, provider });
        });
        
        // Request providers to announce themselves
        window.dispatchEvent(new Event('eip6963:requestProvider'));
        
        // Contract addresses (Ethereum Sepolia Testnet)
        const TOKEN_ADDRESS = '0xe4A39E3D2C64C2D3a1d9c7C6B9eB63db55277b71'; // ARUB Token
        const STAKING_ADDRESS = '0x47B302F223ae94e9efcABc27DE19C0a2eC268Df3'; // ARUB Staking
        
        // DEMO MODE - false –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞–º–∏
        const DEMO_MODE = false;
        
        // Ethereum Sepolia Chain ID
        const SEPOLIA_CHAIN_ID = '0xaa36a7'; // Sepolia Testnet (11155111)
        
        // Contract ABIs (simplified)
        const TOKEN_ABI = [
            "function balanceOf(address) view returns (uint256)",
            "function approve(address spender, uint256 amount) returns (bool)",
            "function transfer(address to, uint256 amount) returns (bool)"
        ];
        
        // ARUB Staking ABI (from actual contract)
        const STAKING_ABI = [
            // Staking functions
            "function stake(uint256 amount)",
            "function unstake(uint256 amount)",
            "function claimRewards(bool compound)",
            "function emergencyWithdraw()",
            
            // View functions
            "function pendingRewards(address account) view returns (uint256)",
            "function getUserInfo(address account) view returns (uint256 stakedAmount, uint256 pendingRewardsAmount, uint256 totalClaimedAmount, uint256 lastStakeTimestamp, uint256 estimatedAPY)",
            "function userInfo(address account) view returns (uint256 stakedAmount, uint256 rewardDebt, uint256 pendingRewards, uint256 lastStakeTime, uint256 totalClaimed)",
            "function getProtocolStats() view returns (uint256 _totalStaked, uint256 _totalStakers, uint256 _totalRewardsDistributed, uint256 _currentAPY, uint256 _totalStakeEvents, uint256 _totalUnstakeEvents, uint256 _totalClaimEvents)",
            "function estimateRewards(address account, uint256 daysAhead) view returns (uint256)",
            "function getCurrentAPY() view returns (uint256)",
            
            // State variables (public = auto getter)
            "function totalStaked() view returns (uint256)",
            "function totalStakers() view returns (uint256)",
            "function totalRewardsDistributed() view returns (uint256)",
            "function minStakeAmount() view returns (uint256)",
            "function compoundingEnabled() view returns (bool)",
            
            // Admin functions
            "function distributeRewards(uint256 amount)"
        ];
        
        let tokenContract = null;
        let stakingContract = null;
        
        // Wallet definitions (lower priority number = checked first)
        const knownWallets = [
            {
                id: 'bybit',
                name: 'Bybit Wallet',
                icon: 'üê¶',
                description: '–ö–æ—à–µ–ª–µ–∫ –æ—Ç Bybit',
                check: (p) => p.isBybitWallet || (p.constructor && p.constructor.name && p.constructor.name.includes('Bybit')) || (p._events && p._events.data && JSON.stringify(p._events).includes('bybit')),
                installUrl: 'https://www.bybit.com/wallet',
                priority: 1
            },
            {
                id: 'uniswap',
                name: 'Uniswap Extension',
                icon: 'ü¶Ñ',
                description: '–ö–æ—à–µ–ª–µ–∫ –æ—Ç Uniswap',
                check: (p) => p.isUniswapWallet || p.isUniswap || (p.constructor && p.constructor.name && p.constructor.name.includes('Uniswap')),
                installUrl: 'https://uniswap.org/',
                priority: 1
            },
            {
                id: 'coinbase',
                name: 'Coinbase Wallet',
                icon: 'üíº',
                description: '–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –∫–æ—à–µ–ª–µ–∫ Coinbase',
                check: (p) => p.isCoinbaseWallet && !p.isMetaMask && !p.isUniswapWallet && !p.isBybitWallet,
                installUrl: 'https://www.coinbase.com/wallet',
                priority: 2
            },
            {
                id: 'rabby',
                name: 'Rabby Wallet',
                icon: 'üê∞',
                description: '–ú—É–ª—å—Ç–∏-—á–µ–π–Ω –∫–æ—à–µ–ª–µ–∫',
                check: (p) => p.isRabby && !p.isUniswapWallet && !p.isBybitWallet,
                installUrl: 'https://rabby.io/',
                priority: 2
            },
            {
                id: 'trust',
                name: 'Trust Wallet',
                icon: 'üõ°Ô∏è',
                description: '–ë—Ä–∞—É–∑–µ—Ä–Ω–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ',
                check: (p) => p.isTrust && !p.isUniswapWallet && !p.isBybitWallet,
                installUrl: 'https://trustwallet.com/',
                priority: 2
            },
            {
                id: 'brave',
                name: 'Brave Wallet',
                icon: 'ü¶Å',
                description: '–í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –∫–æ—à–µ–ª–µ–∫ Brave',
                check: (p) => p.isBraveWallet && !p.isUniswapWallet && !p.isBybitWallet,
                installUrl: 'https://brave.com/wallet/',
                priority: 2
            },
            {
                id: 'metamask',
                name: 'MetaMask',
                icon: 'ü¶ä',
                description: '–ü–æ–ø—É–ª—è—Ä–Ω—ã–π –±—Ä–∞—É–∑–µ—Ä–Ω—ã–π –∫–æ—à–µ–ª–µ–∫',
                check: (p) => {
                    // Must have isMetaMask
                    if (!p.isMetaMask) return false;
                    
                    // Exclude other wallets that pretend to be MetaMask
                    if (p.isUniswapWallet || p.isUniswap) return false;
                    if (p.isBybitWallet) return false;
                    if (p.overrideIsMetaMask) return false;
                    
                    // Check for MetaMask-specific properties
                    const hasMetaMaskSpecific = (
                        p._metamask !== undefined ||
                        (p.constructor && p.constructor.name === 'MetamaskInpageProvider') ||
                        (typeof p.isUnlocked === 'function')
                    );
                    
                    return hasMetaMaskSpecific;
                },
                installUrl: 'https://metamask.io/download/',
                priority: 3
            }
        ];
        
        // Detect available wallets using EIP-6963 and legacy methods
        function detectWallets() {
            const detected = [];
            const notDetected = [];
            
            console.log('=== WALLET DETECTION START ===');
            console.log('EIP-6963 providers:', discoveredProviders);
            
            // Method 1: EIP-6963 (Modern standard - most reliable)
            if (discoveredProviders.size > 0) {
                console.log('Using EIP-6963 providers');
                discoveredProviders.forEach(({ info, provider }, uuid) => {
                    console.log('EIP-6963 provider:', info.name, info);
                    
                    let walletId = 'unknown';
                    let walletIcon = 'üíé';
                    let walletDescription = info.name;
                    
                    // Map known wallets
                    const name = info.name.toLowerCase();
                    if (name.includes('metamask')) {
                        walletId = 'metamask';
                        walletIcon = 'ü¶ä';
                        walletDescription = '–ü–æ–ø—É–ª—è—Ä–Ω—ã–π –±—Ä–∞—É–∑–µ—Ä–Ω—ã–π –∫–æ—à–µ–ª–µ–∫';
                    } else if (name.includes('bybit')) {
                        walletId = 'bybit';
                        walletIcon = 'üê¶';
                        walletDescription = '–ö–æ—à–µ–ª–µ–∫ –æ—Ç Bybit';
                    } else if (name.includes('coinbase')) {
                        walletId = 'coinbase';
                        walletIcon = 'üíº';
                        walletDescription = '–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –∫–æ—à–µ–ª–µ–∫ Coinbase';
                    } else if (name.includes('rabby')) {
                        walletId = 'rabby';
                        walletIcon = 'üê∞';
                        walletDescription = '–ú—É–ª—å—Ç–∏-—á–µ–π–Ω –∫–æ—à–µ–ª–µ–∫';
                    } else if (name.includes('trust')) {
                        walletId = 'trust';
                        walletIcon = 'üõ°Ô∏è';
                        walletDescription = 'Trust Wallet';
                    } else if (name.includes('uniswap')) {
                        walletId = 'uniswap';
                        walletIcon = 'ü¶Ñ';
                        walletDescription = '–ö–æ—à–µ–ª–µ–∫ –æ—Ç Uniswap';
                    }
                    
                    detected.push({
                        id: walletId + '_' + uuid.substring(0, 8),
                        name: info.name,
                        icon: info.icon || walletIcon,
                        description: walletDescription,
                        detected: true,
                        provider: provider,
                        eip6963: true
                    });
                });
            }
            
            // Method 2: Legacy window.ethereum with providerMap
            if (typeof window.ethereum !== 'undefined') {
                console.log('Checking legacy providers');
                
                // Check providerMap (newer method)
                if (window.ethereum.providerMap) {
                    console.log('Found providerMap:', window.ethereum.providerMap);
                    try {
                        window.ethereum.providerMap.forEach((provider, key) => {
                            console.log('ProviderMap entry:', key, provider);
                            
                            // Skip if already added via EIP-6963
                            const alreadyAdded = detected.some(w => w.provider === provider);
                            if (alreadyAdded) {
                                console.log('Provider already added via EIP-6963');
                                return;
                            }
                            
                            let walletId = key.toLowerCase();
                            let walletName = key;
                            let walletIcon = 'üíé';
                            let walletDescription = key;
                            
                            if (key.toLowerCase().includes('metamask')) {
                                walletId = 'metamask';
                                walletName = 'MetaMask';
                                walletIcon = 'ü¶ä';
                                walletDescription = '–ü–æ–ø—É–ª—è—Ä–Ω—ã–π –±—Ä–∞—É–∑–µ—Ä–Ω—ã–π –∫–æ—à–µ–ª–µ–∫';
                            } else if (key.toLowerCase().includes('coinbase')) {
                                walletId = 'coinbase';
                                walletName = 'Coinbase Wallet';
                                walletIcon = 'üíº';
                                walletDescription = '–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –∫–æ—à–µ–ª–µ–∫ Coinbase';
                            }
                            
                            detected.push({
                                id: walletId + '_map',
                                name: walletName,
                                icon: walletIcon,
                                description: walletDescription,
                                detected: true,
                                provider: provider,
                                fromProviderMap: true
                            });
                        });
                    } catch (e) {
                        console.error('Error iterating providerMap:', e);
                    }
                }
                
                // Check providers array (legacy)
                const providers = window.ethereum.providers || [window.ethereum];
                console.log('Legacy providers array:', providers.length);
                
                providers.forEach((p, index) => {
                    // Skip if already added
                    const alreadyAdded = detected.some(w => w.provider === p);
                    if (alreadyAdded) {
                        console.log('Provider', index, 'already added');
                        return;
                    }
                    
                    console.log(`Legacy Provider ${index}:`, {
                        isMetaMask: p.isMetaMask,
                        isCoinbaseWallet: p.isCoinbaseWallet,
                        isRabby: p.isRabby,
                        isBybitWallet: p.isBybitWallet
                    });
                    
                    // Identify wallet
                    let walletId = 'unknown';
                    let walletName = 'Unknown Wallet';
                    let walletIcon = 'üíé';
                    let walletDescription = 'Web3 –∫–æ—à–µ–ª–µ–∫';
                    
                    if (p.isMetaMask && !p.isBybitWallet && !p.isUniswapWallet) {
                        walletId = 'metamask';
                        walletName = 'MetaMask';
                        walletIcon = 'ü¶ä';
                        walletDescription = '–ü–æ–ø—É–ª—è—Ä–Ω—ã–π –±—Ä–∞—É–∑–µ—Ä–Ω—ã–π –∫–æ—à–µ–ª–µ–∫';
                    } else if (p.isBybitWallet) {
                        walletId = 'bybit';
                        walletName = 'Bybit Wallet';
                        walletIcon = 'üê¶';
                        walletDescription = '–ö–æ—à–µ–ª–µ–∫ –æ—Ç Bybit';
                    } else if (p.isCoinbaseWallet) {
                        walletId = 'coinbase';
                        walletName = 'Coinbase Wallet';
                        walletIcon = 'üíº';
                        walletDescription = '–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –∫–æ—à–µ–ª–µ–∫ Coinbase';
                    } else if (p.isRabby) {
                        walletId = 'rabby';
                        walletName = 'Rabby Wallet';
                        walletIcon = 'üê∞';
                        walletDescription = '–ú—É–ª—å—Ç–∏-—á–µ–π–Ω –∫–æ—à–µ–ª–µ–∫';
                    } else if (p.isUniswapWallet) {
                        walletId = 'uniswap';
                        walletName = 'Uniswap Extension';
                        walletIcon = 'ü¶Ñ';
                        walletDescription = '–ö–æ—à–µ–ª–µ–∫ –æ—Ç Uniswap';
                    }
                    
                    if (walletId !== 'unknown') {
                        detected.push({
                            id: walletId + '_legacy_' + index,
                            name: walletName,
                            icon: walletIcon,
                            description: walletDescription,
                            detected: true,
                            provider: p,
                            legacy: true
                        });
                    }
                });
            }
            
            console.log('=== WALLET DETECTION END ===');
            console.log('Total detected:', detected.length);
            console.log('Detected wallets:', detected.map(w => w.name));
            
            // Add not detected wallets for installation links
            if (detected.length === 0 || !detected.find(w => w.name.includes('MetaMask'))) {
                notDetected.push({
                    id: 'metamask',
                    name: 'MetaMask',
                    icon: 'ü¶ä',
                    description: '–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ',
                    detected: false,
                    installUrl: 'https://metamask.io/download/'
                });
            }
            
            return { detected, notDetected };
        }
        
        // Render wallet options
        function renderWalletOptions() {
            const { detected, notDetected } = detectWallets();
            const container = document.getElementById('walletOptions');
            container.innerHTML = '';
            
            if (detected.length === 0) {
                // No wallets detected
                container.innerHTML = `
                    <div class="no-wallets-msg">
                        <h3>–ö–æ—à–µ–ª—å–∫–∏ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã</h3>
                        <p>–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –æ–¥–∏–Ω –∏–∑ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö Web3 –∫–æ—à–µ–ª—å–∫–æ–≤:</p>
                        <div class="install-links">
                            <a href="https://metamask.io/download/" target="_blank" class="install-link">
                                ü¶ä –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å MetaMask
                            </a>
                            <a href="https://www.coinbase.com/wallet" target="_blank" class="install-link">
                                üíº –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Coinbase Wallet
                            </a>
                            <a href="https://rabby.io/" target="_blank" class="install-link">
                                üê∞ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Rabby Wallet
                            </a>
                        </div>
                    </div>
                `;
                return;
            }
            
            // Render detected wallets
            detected.forEach(wallet => {
                const option = document.createElement('div');
                option.className = 'wallet-option';
                option.onclick = () => connectWallet(wallet);
                
                let warningHTML = '';
                if (wallet.id === 'metamask') {
                    const bybitDetected = detected.find(w => w.id === 'bybit');
                    if (bybitDetected) {
                        warningHTML = '<div style="grid-column: 1/-1; margin-top: 10px; padding: 10px; background: rgba(255,165,0,0.1); border: 1px solid orange; border-radius: 8px; font-size: 0.85em; color: orange;">‚ö†Ô∏è –ï—Å–ª–∏ –æ—Ç–∫—Ä–æ–µ—Ç—Å—è Bybit –≤–º–µ—Å—Ç–æ MetaMask - –æ—Ç–∫–ª—é—á–∏—Ç–µ Bybit Wallet –≤ chrome://extensions/</div>';
                    }
                }
                
                option.innerHTML = `
                    <div class="wallet-icon">${wallet.icon}</div>
                    <div class="wallet-details">
                        <div class="wallet-name">${wallet.name}</div>
                        <div class="wallet-description">${wallet.description}</div>
                    </div>
                    <span class="wallet-tag detected">‚úì –û–±–Ω–∞—Ä—É–∂–µ–Ω</span>
                    ${warningHTML}
                `;
                
                container.appendChild(option);
            });
            
            // Render not detected wallets
            notDetected.forEach(wallet => {
                const option = document.createElement('div');
                option.className = 'wallet-option disabled';
                option.onclick = () => {
                    window.open(wallet.installUrl, '_blank');
                };
                
                option.innerHTML = `
                    <div class="wallet-icon">${wallet.icon}</div>
                    <div class="wallet-details">
                        <div class="wallet-name">${wallet.name}</div>
                        <div class="wallet-description">–ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω - –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏</div>
                    </div>
                    <span class="wallet-tag not-found">–ù–µ –Ω–∞–π–¥–µ–Ω</span>
                `;
                
                container.appendChild(option);
            });
        }
        
        // Modal Functions
        async function openWalletModal() {
            // Wait a bit for EIP-6963 providers to announce themselves
            await new Promise(resolve => setTimeout(resolve, 100));
            
            renderWalletOptions();
            document.getElementById('walletModal').classList.add('show');
        }
        
        function closeWalletModal() {
            document.getElementById('walletModal').classList.remove('show');
        }
        
        // Universal Wallet Connection
        async function connectWallet(wallet) {
            try {
                console.log('=== CONNECTING WALLET ===');
                console.log('Wallet to connect:', wallet.name);
                console.log('Wallet provider:', wallet.provider);
                
                if (!wallet.provider) {
                    showNotification('–ü—Ä–æ–≤–∞–π–¥–µ—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
                    return;
                }
                
                showNotification(translations[currentLang]['connecting']);
                closeWalletModal();
                
                // IMPORTANT: Use the specific provider, not window.ethereum
                const ethereum = wallet.provider;
                
                console.log('Using provider:', {
                    isMetaMask: ethereum.isMetaMask,
                    isCoinbaseWallet: ethereum.isCoinbaseWallet,
                    isRabby: ethereum.isRabby,
                    constructor: ethereum.constructor?.name
                });
                
                // Request accounts from the SPECIFIC provider
                console.log('Requesting accounts...');
                const accounts = await ethereum.request({ 
                    method: 'eth_requestAccounts' 
                });
                console.log('Accounts received:', accounts);
                
                // Create provider from the SPECIFIC ethereum instance
                provider = new ethers.providers.Web3Provider(ethereum);
                await checkAndSwitchNetwork(ethereum);
                
                userAddress = accounts[0];
                signer = provider.getSigner();
                currentWalletType = wallet.id;
                
                console.log('Connected address:', userAddress);
                console.log('Wallet type:', currentWalletType);
                
                initializeContracts();
                updateWalletUI();
                await loadAllData();
                
                showNotification(`${wallet.name} –ø–æ–¥–∫–ª—é—á–µ–Ω!`, 'success');
                console.log('=== CONNECTION SUCCESSFUL ===');
                
                // Listen for events on the SPECIFIC provider
                ethereum.on('accountsChanged', handleAccountsChanged);
                ethereum.on('chainChanged', () => location.reload());
                
            } catch (error) {
                console.error('=== CONNECTION ERROR ===');
                console.error('Error details:', error);
                if (error.code === 4001) {
                    showNotification(translations[currentLang]['wallet-rejected'], 'error');
                } else {
                    showNotification('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ' + error.message, 'error');
                }
            }
        }
        
        // Disconnect Wallet
        async function disconnectWallet() {
            provider = null;
            signer = null;
            userAddress = null;
            tokenContract = null;
            stakingContract = null;
            currentWalletType = null;
            
            document.getElementById('connectBtn').style.display = 'block';
            document.getElementById('walletInfo').classList.remove('connected');
            
            showNotification('–ö–æ—à–µ–ª–µ–∫ –æ—Ç–∫–ª—é—á–µ–Ω', 'info');
        }
        
        // Handle Account Changes
        function handleAccountsChanged(accounts) {
            if (accounts.length === 0) {
                disconnectWallet();
            } else {
                location.reload();
            }
        }
        
        // Check and Switch to Sepolia
        async function checkAndSwitchNetwork(ethereum) {
            try {
                console.log('Checking network...');
                const chainId = await ethereum.request({ method: 'eth_chainId' });
                console.log('Current chain ID:', chainId);
                console.log('Expected chain ID:', SEPOLIA_CHAIN_ID);
                
                if (chainId !== SEPOLIA_CHAIN_ID) {
                    console.log('Wrong network detected!');
                    showNotification('‚ö†Ô∏è –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ Sepolia Testnet', 'warning');
                    
                    try {
                        console.log('Requesting network switch...');
                        await ethereum.request({
                            method: 'wallet_switchEthereumChain',
                            params: [{ chainId: SEPOLIA_CHAIN_ID }],
                        });
                        console.log('Network switched successfully');
                        showNotification('‚úÖ –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–æ –Ω–∞ Sepolia', 'success');
                        
                        // Wait for network to fully switch
                        await new Promise(resolve => setTimeout(resolve, 1000));
                        
                    } catch (switchError) {
                        console.error('Switch error:', switchError);
                        
                        if (switchError.code === 4902) {
                            // Network not found, add it
                            console.log('Network not found, adding Sepolia...');
                            showNotification('–î–æ–±–∞–≤–ª–µ–Ω–∏–µ Sepolia Testnet...', 'info');
                            
                            try {
                                await ethereum.request({
                                    method: 'wallet_addEthereumChain',
                                    params: [{
                                        chainId: SEPOLIA_CHAIN_ID,
                                        chainName: 'Sepolia Testnet',
                                        nativeCurrency: {
                                            name: 'Ethereum',
                                            symbol: 'ETH',
                                            decimals: 18
                                        },
                                        rpcUrls: ['https://sepolia.infura.io/v3/1c87f73ab8754dc38ceafba1d3ece1a0'],
                                        blockExplorerUrls: ['https://sepolia.etherscan.io']
                                    }],
                                });
                                console.log('Network added successfully');
                                showNotification('‚úÖ Sepolia –¥–æ–±–∞–≤–ª–µ–Ω–∞! –ü–µ—Ä–µ–∫–ª—é—á–∞—é—Å—å...', 'success');
                                
                                // Reload after adding network
                                setTimeout(() => location.reload(), 1500);
                                
                            } catch (addError) {
                                console.error('Add network error:', addError);
                                throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å Sepolia. –î–æ–±–∞–≤—å—Ç–µ –≤—Ä—É—á–Ω—É—é –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –∫–æ—à–µ–ª—å–∫–∞.');
                            }
                        } else if (switchError.code === 4001) {
                            // User rejected
                            throw new Error('–í—ã –æ—Ç–∫–ª–æ–Ω–∏–ª–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å–µ—Ç–∏. –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ—Å—å –Ω–∞ Sepolia –≤—Ä—É—á–Ω—É—é.');
                        } else {
                            throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Å–µ—Ç—å: ' + switchError.message);
                        }
                    }
                    
                    // Double check after switch
                    const newChainId = await ethereum.request({ method: 'eth_chainId' });
                    if (newChainId !== SEPOLIA_CHAIN_ID) {
                        throw new Error('–°–µ—Ç—å –Ω–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∞ –Ω–∞ Sepolia. –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ –≤—Ä—É—á–Ω—É—é.');
                    }
                } else {
                    console.log('Already on Sepolia ‚úì');
                }
            } catch (error) {
                console.error('Network check error:', error);
                throw error; // Re-throw to stop connection
            }
        }
        
        // Initialize Contracts
        function initializeContracts() {
            if (provider && signer) {
                tokenContract = new ethers.Contract(TOKEN_ADDRESS, TOKEN_ABI, signer);
                stakingContract = new ethers.Contract(STAKING_ADDRESS, STAKING_ABI, signer);
            }
        }
        
        // Update Wallet UI
        function updateWalletUI() {
            document.getElementById('connectBtn').style.display = 'none';
            document.getElementById('walletInfo').classList.add('connected');
            
            const shortAddress = userAddress.slice(0, 6) + '...' + userAddress.slice(-4);
            document.getElementById('walletAddress').textContent = shortAddress;
        }
        
        // Copy Address
        function copyAddress() {
            if (userAddress) {
                navigator.clipboard.writeText(userAddress);
                showNotification(translations[currentLang]['copied'], 'success');
            }
        }
        
        // ==========================================
        // LOAD DATA
        // ==========================================
        async function loadAllData() {
            try {
                // ETH Balance
                const ethBalance = await provider.getBalance(userAddress);
                const ethFormatted = ethers.utils.formatEther(ethBalance);
                document.getElementById('walletBalance').textContent = 
                    `${parseFloat(ethFormatted).toFixed(4)} ETH`;
                
                if (DEMO_MODE) {
                    // DEMO MODE: Show simulated balances
                    console.log('üé≠ DEMO MODE: Showing simulated balances');
                    
                    const demoBalance = Math.floor(Math.random() * 4000) + 1000;
                    document.getElementById('userBalance').textContent = demoBalance.toFixed(2);
                    
                    const usdValue = demoBalance * 0.001;
                    document.getElementById('usdValue').textContent = `$${usdValue.toFixed(2)}`;
                    
                    const demoStaked = Math.floor(demoBalance * 0.3);
                    document.getElementById('stakedAmount').textContent = demoStaked.toFixed(2);
                    
                    const demoRewards = (Math.random() * 40 + 10).toFixed(2);
                    document.getElementById('rewardsEarned').textContent = demoRewards;
                    document.getElementById('rewardsDisplay').textContent = demoRewards;
                    
                    const demoTotalStaked = Math.floor(Math.random() * 900000) + 100000;
                    document.getElementById('totalStaked').textContent = demoTotalStaked.toLocaleString();
                    
                    return;
                }
                
                // REAL MODE: Load from contracts with smart function detection
                console.log('Loading token balance...');
                if (tokenContract && TOKEN_ADDRESS !== '0x0000000000000000000000000000000000000000') {
                    try {
                        const balance = await tokenContract.balanceOf(userAddress);
                        const balanceFormatted = ethers.utils.formatEther(balance);
                        console.log('Token balance:', balanceFormatted, 'ARUB');
                        
                        document.getElementById('userBalance').textContent = 
                            parseFloat(balanceFormatted).toFixed(2);
                        
                        const usdValue = parseFloat(balanceFormatted) * 0.001;
                        document.getElementById('usdValue').textContent = 
                            `$${usdValue.toFixed(2)}`;
                    } catch (error) {
                        console.error('Error loading token balance:', error);
                        document.getElementById('userBalance').textContent = 'Error';
                        document.getElementById('usdValue').textContent = '$0.00';
                    }
                } else {
                    document.getElementById('userBalance').textContent = '0.00';
                    document.getElementById('usdValue').textContent = '$0.00';
                }
                
                console.log('Loading staking data...');
                if (stakingContract && STAKING_ADDRESS !== '0x0000000000000000000000000000000000000000') {
                    try {
                        // Use getUserInfo - returns all data at once!
                        console.log('Calling getUserInfo...');
                        const result = await stakingContract.getUserInfo(userAddress);
                        
                        // result = [stakedAmount, pendingRewardsAmount, totalClaimedAmount, lastStakeTimestamp, estimatedAPY]
                        const stakedAmount = result[0];
                        const pendingRewards = result[1];
                        
                        console.log('‚úÖ Staked:', ethers.utils.formatEther(stakedAmount), 'ARUB');
                        console.log('‚úÖ Rewards:', ethers.utils.formatEther(pendingRewards), 'ARUB');
                        
                        // Display staked amount
                        document.getElementById('stakedAmount').textContent = 
                            parseFloat(ethers.utils.formatEther(stakedAmount)).toFixed(2);
                        
                        // Display pending rewards
                        document.getElementById('rewardsEarned').textContent = 
                            parseFloat(ethers.utils.formatEther(pendingRewards)).toFixed(2);
                        document.getElementById('rewardsDisplay').textContent = 
                            parseFloat(ethers.utils.formatEther(pendingRewards)).toFixed(2);
                        
                        // Get total staked
                        console.log('Getting totalStaked...');
                        const totalStakedAmount = await stakingContract.totalStaked();
                        console.log('‚úÖ Total staked:', ethers.utils.formatEther(totalStakedAmount), 'ARUB');
                        
                        document.getElementById('totalStaked').textContent = 
                            parseFloat(ethers.utils.formatEther(totalStakedAmount)).toFixed(0);
                        
                        console.log('‚úÖ All staking data loaded!');
                        
                    } catch (error) {
                        console.error('‚ùå Error loading staking data:', error);
                        document.getElementById('stakedAmount').textContent = 'Error';
                        document.getElementById('rewardsEarned').textContent = 'Error';
                        document.getElementById('rewardsDisplay').textContent = '0.00';
                        document.getElementById('totalStaked').textContent = 'Error';
                    }
                } else {
                    document.getElementById('stakedAmount').textContent = '0';
                    document.getElementById('rewardsEarned').textContent = '0';
                    document.getElementById('rewardsDisplay').textContent = '0.00';
                    document.getElementById('totalStaked').textContent = '0';
                }
                
                console.log('‚úì Data loaded successfully');
                
            } catch (error) {
                console.error('Error loading data:', error);
                
                // Check if it's a network error
                if (error.code === 'CALL_EXCEPTION' || error.message.includes('revert')) {
                    showNotification('‚ö†Ô∏è –û—à–∏–±–∫–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –≤—ã –Ω–∞ Sepolia Testnet!', 'error');
                    
                    try {
                        const network = await provider.getNetwork();
                        console.error('Current network:', network);
                        if (network.chainId !== 11155111) {
                            showNotification(`‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å–µ—Ç—å! –¢–µ–∫—É—â–∞—è: ${network.name} (${network.chainId}). –ù—É–∂–Ω–∞: Sepolia (11155111)`, 'error');
                        }
                    } catch (netError) {
                        console.error('Could not get network:', netError);
                    }
                } else {
                    showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö: ' + error.message, 'error');
                }
            }
        }
        
        // ==========================================
        // STAKING FUNCTIONS
        // ==========================================
        function setMaxAmount() {
            if (!userAddress) {
                showNotification(translations[currentLang]['connect-first'], 'error');
                return;
            }
            document.getElementById('stakeAmount').value = '1000';
        }
        
        async function approveTokens() {
            if (!userAddress) {
                showNotification(translations[currentLang]['connect-first'], 'error');
                return;
            }
            
            if (DEMO_MODE) {
                showNotification('üé≠ DEMO: –û–¥–æ–±—Ä–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ —Å–∏–º—É–ª–∏—Ä–æ–≤–∞–Ω–æ', 'success');
                return;
            }
            
            if (!tokenContract) {
                showNotification('–ö–æ–Ω—Ç—Ä–∞–∫—Ç —Ç–æ–∫–µ–Ω–∞ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω', 'error');
                return;
            }
            
            const amount = document.getElementById('stakeAmount').value;
            if (!amount || parseFloat(amount) <= 0) {
                showNotification(translations[currentLang]['invalid-amount'], 'error');
                return;
            }
            
            try {
                showNotification(translations[currentLang]['approving']);
                
                const amountWei = ethers.utils.parseEther(amount);
                const tx = await tokenContract.approve(STAKING_ADDRESS, amountWei);
                await tx.wait();
                
                showNotification(translations[currentLang]['approve-success'], 'success');
                
            } catch (error) {
                console.error('Approve error:', error);
                showNotification(
                    translations[currentLang]['approve-error'] + error.message,
                    'error'
                );
            }
        }
        
        async function stakeTokens() {
            if (!userAddress) {
                showNotification(translations[currentLang]['connect-first'], 'error');
                return;
            }
            
            const amount = document.getElementById('stakeAmount').value;
            if (!amount || parseFloat(amount) <= 0) {
                showNotification(translations[currentLang]['invalid-amount'], 'error');
                return;
            }
            
            if (DEMO_MODE) {
                showNotification('üé≠ DEMO: –°—Ç–µ–π–∫–∏–Ω–≥ —Å–∏–º—É–ª–∏—Ä–æ–≤–∞–Ω. –í —Ä–µ–∞–ª—å–Ω–æ–º —Ä–µ–∂–∏–º–µ —Ç–æ–∫–µ–Ω—ã –±—É–¥—É—Ç –∑–∞—Å—Ç–µ–π–∫–∞–Ω—ã –≤ –∫–æ–Ω—Ç—Ä–∞–∫—Ç.', 'success');
                document.getElementById('stakeAmount').value = '';
                
                // Update demo values
                setTimeout(async () => {
                    await loadAllData();
                }, 500);
                return;
            }
            
            if (!stakingContract) {
                showNotification('–ö–æ–Ω—Ç—Ä–∞–∫—Ç —Å—Ç–µ–π–∫–∏–Ω–≥–∞ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω', 'error');
                return;
            }
            
            try {
                showNotification(translations[currentLang]['staking']);
                
                const amountWei = ethers.utils.parseEther(amount);
                const tx = await stakingContract.stake(amountWei);
                await tx.wait();
                
                showNotification(translations[currentLang]['stake-success'], 'success');
                
                document.getElementById('stakeAmount').value = '';
                await loadAllData();
                
            } catch (error) {
                console.error('Staking error:', error);
                showNotification(
                    translations[currentLang]['stake-error'] + error.message,
                    'error'
                );
            }
        }
        
        async function unstakeTokens() {
            if (!userAddress) {
                showNotification(translations[currentLang]['connect-first'], 'error');
                return;
            }
            
            const amount = document.getElementById('stakeAmount').value;
            if (!amount || parseFloat(amount) <= 0) {
                showNotification(translations[currentLang]['invalid-amount'], 'error');
                return;
            }
            
            if (DEMO_MODE) {
                showNotification('üé≠ DEMO: –í—ã–≤–æ–¥ —Å–∏–º—É–ª–∏—Ä–æ–≤–∞–Ω', 'success');
                document.getElementById('stakeAmount').value = '';
                return;
            }
            
            if (!stakingContract) {
                showNotification('–ö–æ–Ω—Ç—Ä–∞–∫—Ç —Å—Ç–µ–π–∫–∏–Ω–≥–∞ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω', 'error');
                return;
            }
            
            try {
                showNotification(translations[currentLang]['unstaking']);
                
                const amountWei = ethers.utils.parseEther(amount);
                const tx = await stakingContract.unstake(amountWei);
                await tx.wait();
                
                showNotification(translations[currentLang]['unstake-success'], 'success');
                
                document.getElementById('stakeAmount').value = '';
                await loadAllData();
                
            } catch (error) {
                console.error('Unstaking error:', error);
                showNotification(
                    translations[currentLang]['unstake-error'] + error.message,
                    'error'
                );
            }
        }
        
        async function claimRewards() {
            if (!userAddress) {
                showNotification(translations[currentLang]['connect-first'], 'error');
                return;
            }
            
            if (DEMO_MODE) {
                showNotification('üé≠ DEMO: –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞–≥—Ä–∞–¥ —Å–∏–º—É–ª–∏—Ä–æ–≤–∞–Ω–æ', 'success');
                return;
            }
            
            if (!stakingContract) {
                showNotification('–ö–æ–Ω—Ç—Ä–∞–∫—Ç —Å—Ç–µ–π–∫–∏–Ω–≥–∞ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω', 'error');
                return;
            }
            
            try {
                showNotification(translations[currentLang]['claiming']);
                
                const tx = await stakingContract.claimRewards();
                await tx.wait();
                
                showNotification(translations[currentLang]['claim-success'], 'success');
                
                await loadAllData();
                
            } catch (error) {
                console.error('Claiming error:', error);
                showNotification(
                    translations[currentLang]['claim-error'] + error.message,
                    'error'
                );
            }
        }
        
        // ==========================================
        // USDT/RUB RATE
        // ==========================================
        async function fetchUsdtRubRate() {
            try {
                // Using CoinGecko API with CORS support
                const response = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=tether&vs_currencies=rub');
                
                if (!response.ok) {
                    throw new Error('API response not ok');
                }
                
                const data = await response.json();
                
                if (data && data.tether && data.tether.rub) {
                    const rate = data.tether.rub;
                    document.getElementById('usdtRubRate').textContent = 
                        `${rate.toFixed(2)} ‚ÇΩ`;
                    
                    const now = new Date();
                    document.getElementById('rateTimestamp').textContent = 
                        `–û–±–Ω–æ–≤–ª–µ–Ω–æ: ${now.toLocaleTimeString('ru-RU')}`;
                    
                    // Calculate devaluation (mock data based on rate)
                    const devaluation = ((rate - 90) / 90 * 100).toFixed(1);
                    document.getElementById('devaluation').textContent = 
                        `${Math.abs(devaluation)}%`;
                    document.getElementById('devaluationChange').textContent = 
                        `‚Üì -${(Math.abs(devaluation) * 0.2).toFixed(1)}% –∑–∞ –º–µ—Å—è—Ü`;
                } else {
                    throw new Error('Invalid data format');
                }
            } catch (error) {
                console.error('Error fetching rate:', error);
                // Set fallback data - don't spam errors
                const fallbackRate = 95.50;
                document.getElementById('usdtRubRate').textContent = 
                    `${fallbackRate.toFixed(2)} ‚ÇΩ`;
                document.getElementById('rateTimestamp').textContent = 
                    '–ö—É—Ä—Å (—Å—Ç–∞—Ç–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)';
                
                const devaluation = 5.2;
                document.getElementById('devaluation').textContent = 
                    `${devaluation.toFixed(1)}%`;
                document.getElementById('devaluationChange').textContent = 
                    `‚Üì -${(devaluation * 0.2).toFixed(1)}% –∑–∞ –º–µ—Å—è—Ü`;
            }
        }
        
        // ==========================================
        // NOTIFICATIONS
        // ==========================================
        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type} show`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 4000);
        }
        
        // ==========================================
        // INITIALIZATION
        // ==========================================
        window.addEventListener('DOMContentLoaded', async () => {
            // Request EIP-6963 providers
            console.log('Requesting EIP-6963 providers...');
            window.dispatchEvent(new Event('eip6963:requestProvider'));
            
            // Wait a bit for providers to respond
            await new Promise(resolve => setTimeout(resolve, 100));
            console.log('EIP-6963 providers received:', discoveredProviders.size);
            
            await fetchUsdtRubRate();
            
            // Update rate every 5 minutes (300000ms) to avoid rate limiting
            setInterval(fetchUsdtRubRate, 300000);
        });
    </script>
</body>
</html>
