<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ANTIRUB Staking Dashboard</title>
<style>
  body {
    font-family: "Inter", sans-serif;
    background: #0b1221;
    color: #fff;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 40px 20px;
  }
  h1 {
    font-size: 2rem;
    margin-bottom: 10px;
    color: #00e5ff;
  }
  .stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 20px;
    width: 100%;
    max-width: 1200px;
    margin-top: 20px;
  }
  .stat-card {
    background: #151e34;
    border-radius: 16px;
    padding: 20px;
    text-align: center;
    box-shadow: 0 0 20px rgba(0, 229, 255, 0.1);
  }
  .stat-label {
    color: #b0b0b0;
    margin-bottom: 8px;
    font-size: 0.9rem;
  }
  .stat-value {
    font-size: 1.6rem;
    font-weight: 700;
    color: #ffcd00;
  }
  .sub-value {
    color: #bbb;
    font-size: 0.9rem;
  }
  footer {
    margin-top: 40px;
    font-size: 0.9rem;
    color: #999;
  }
  .loading {
    color: #00e5ff;
    font-size: 1rem;
    margin-top: 10px;
  }
</style>
</head>
<body>
  <h1>ANTIRUB Staking Dashboard</h1>
  <div id="loadingText" class="loading">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö...</div>

  <div class="stats" id="stats" style="display:none;">
    <div class="stat-card">
      <div class="stat-label">üí∞ –í—Å—å–æ–≥–æ –∑–∞—Å—Ç–µ–π–∫–∞–Ω–æ</div>
      <div class="stat-value" id="totalStaked">$0</div>
      <div class="sub-value" id="totalStakedTokens">0 —Ç–æ–∫–µ–Ω—ñ–≤</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">üìà –ü–æ—Ç–æ—á–Ω–∏–π APY</div>
      <div class="stat-value" id="apy">0%</div>
      <div class="sub-value">–†—ñ—á–Ω–∏–π –≤—ñ–¥—Å–æ—Ç–æ–∫</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">üöÄ –í–∏–ø—É—â–µ–Ω–æ ARUB</div>
      <div class="stat-value" id="totalSupply">0</div>
      <div class="sub-value" id="totalSupplyTokens">$0</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">üíµ –¶—ñ–Ω–∞ 1 ARUB</div>
      <div class="stat-value" id="price">$0</div>
      <div class="sub-value">—É USDT</div>
    </div>
  </div>

  <footer>¬© 2025 ANTIRUB | –î–∞–Ω—ñ –∑ Sepolia Testnet</footer>

<script>
const RPC_URLS = [
  "https://ethereum-sepolia-rpc.publicnode.com",
  "https://1rpc.io/sepolia",
  "https://rpc.sepolia.org"
];

const CONTRACTS = {
  STAKING: "0xd98F611370262f7494eee27f55bc9a8922a9a66d",
  ARUB: "0x98fFc1A4Ff6eAD8EebFd02cDA54852Bb69744788"
};

async function callContractWithFallback(address, data) {
  for (const url of RPC_URLS) {
    try {
      const res = await fetch(url, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          jsonrpc: "2.0",
          id: 1,
          method: "eth_call",
          params: [{ to: address, data }, "latest"]
        })
      });
      const json = await res.json();
      if (json.result) return json.result;
    } catch (e) {
      console.warn("RPC error:", e);
    }
  }
  throw new Error("–£—Å—ñ RPC-–Ω–æ–¥–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ñ");
}

function fromHexToNumber(hex) {
  if (!hex || hex === "0x") return 0;
  return Number(BigInt(hex));
}

async function loadStats() {
  const loadingText = document.getElementById("loadingText");
  const statsDiv = document.getElementById("stats");
  loadingText.style.display = "block";
  statsDiv.style.display = "none";

  try {
    // –û—Ç—Ä–∏–º—É—î–º–æ –∫—É—Ä—Å USD/RUB
    const rateRes = await fetch("https://api.exchangerate-api.com/v4/latest/USD");
    const rateData = await rateRes.json();
    const rate = rateData.rates.RUB; // –Ω–∞–ø—Ä–∏–∫–ª–∞–¥ 81.16

    // –í–∏–∫–ª–∏–∫–∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ñ–≤
    const totalStakedHex = await callContractWithFallback(CONTRACTS.STAKING, "0x817b1cd2");
    const totalSupplyHex = await callContractWithFallback(CONTRACTS.ARUB, "0x18160ddd");

    const totalStakedRaw = fromHexToNumber(totalStakedHex);
    const totalSupplyRaw = fromHexToNumber(totalSupplyHex);

    const totalStakedTokens = totalStakedRaw / 1e6;
    const totalSupplyTokens = totalSupplyRaw / 1e6;

    // –¶—ñ–Ω–∞ 1 ARUB = –∫—É—Ä—Å USD/RUB, –∞–ª–µ –≤ –¥–æ–ª–∞—Ä–∞—Ö
    const arubPriceUsd = rate;

    // –ü–µ—Ä–µ—Ä–∞—Ö—É–Ω–æ–∫ —É USD
    const totalStakedUsd = totalStakedTokens * arubPriceUsd;
    const totalSupplyUsd = totalSupplyTokens * arubPriceUsd;

    // APY —Ñ—ñ–∫—Å–æ–≤–∞–Ω–∏–π (–¥–ª—è –ø—Ä–∏–∫–ª–∞–¥—É)
    const apy = 24;

    // –û–Ω–æ–≤–ª—é—î–º–æ DOM
    document.getElementById("totalStaked").textContent = "$" + totalStakedUsd.toLocaleString("en-US", {maximumFractionDigits: 0});
    document.getElementById("totalStakedTokens").textContent = totalStakedTokens.toLocaleString("en-US", {maximumFractionDigits: 2}) + " —Ç–æ–∫–µ–Ω—ñ–≤";

    document.getElementById("apy").textContent = apy + "%";

    document.getElementById("totalSupply").textContent = totalSupplyTokens.toLocaleString("en-US", {maximumFractionDigits: 0});
    document.getElementById("totalSupplyTokens").textContent = "$" + totalSupplyUsd.toLocaleString("en-US", {maximumFractionDigits: 0});

    document.getElementById("price").textContent = "$" + arubPriceUsd.toFixed(2);

    loadingText.style.display = "none";
    statsDiv.style.display = "grid";
  } catch (err) {
    console.error(err);
    document.getElementById("loadingText").textContent = "‚ö†Ô∏è –ù–µ –≤–¥–∞–ª–æ—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–∞–Ω—ñ. –ü–æ–≤—Ç–æ—Ä —á–µ—Ä–µ–∑ 30 —Å.";
  }
}

// –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç—ñ
loadStats();
// –ê–≤—Ç–æ–æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ–∂–Ω—ñ 60 —Å–µ–∫—É–Ω–¥
setInterval(loadStats, 60000);
</script>
</body>
</html>
